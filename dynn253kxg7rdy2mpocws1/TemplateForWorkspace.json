{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"workspaceName": {
			"type": "string",
			"metadata": "Workspace name",
			"defaultValue": "dynn253kxg7rdy2mpocws1"
		},
		"AzureDataLakeStorage1_accountKey": {
			"type": "secureString",
			"metadata": "Secure string for 'accountKey' of 'AzureDataLakeStorage1'"
		},
		"AzureSqlDatabase1_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'AzureSqlDatabase1'"
		},
		"AzureDataLakeStorage1_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://dynn253kxg7rdy2mpoc.dfs.core.windows.net"
		},
		"keyVaultLinkedservice_properties_typeProperties_baseUrl": {
			"type": "string",
			"defaultValue": "@{concat('https://',linkedService().keyVaultName,'.vault.azure.net/')}"
		}
	},
	"variables": {
		"workspaceId": "[concat('Microsoft.Synapse/workspaces/', parameters('workspaceName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('workspaceName'), '/Copy Dataverse data from Azure Data Lake to Azure SQL')]",
			"type": "Microsoft.Synapse/workspaces/pipelines",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "After using Azure Synapse Link for Dataverse, use this template to copy the Dataverse data from Azure Data Lake to Azure SQL.",
				"activities": [
					{
						"name": "Dataverse mapping to Azure SQL",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "1.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "DataverseToAzureSQL",
								"type": "DataFlowReference",
								"parameters": {
									"ContainerName": {
										"value": "'@{\"dataverse-salestrial-unq1cc8161bd798478faef1b51afa8f1\"}'",
										"type": "Expression"
									},
									"TableName": {
										"value": "'@{\"mytable\"}'",
										"type": "Expression"
									}
								},
								"datasetParameters": {
									"ADLS": {},
									"SQL": {
										"SQLTableName": "\"SQL Table Name\""
									}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"annotations": [],
				"lastPublishTime": "2021-09-18T04:58:41Z"
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/dataflows/DataverseToAzureSQL')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureSqlTable')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "The destination Azure SQL Table for the Dataverse data.",
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase1",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"SQLTableName": {
						"type": "string",
						"defaultValue": "\"SQL Table Name\""
					}
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": "dbo",
					"table": {
						"value": "@dataset().SQLTableName",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureSqlTable1')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "The destination Azure SQL Table for the Dataverse data.",
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase1",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"SQLTableName": {
						"type": "string",
						"defaultValue": "\"SQL Table Name\""
					}
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": "dbo",
					"table": {
						"value": "@dataset().SQLTableName",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureSqlTable2')]",
			"type": "Microsoft.Synapse/workspaces/datasets",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "The destination Azure SQL Table for the Dataverse data.",
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase1",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"SQLTableName": {
						"type": "string",
						"defaultValue": "\"SQL Table Name\""
					}
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": "dbo",
					"table": {
						"value": "@dataset().SQLTableName",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/AzureSqlDatabase1')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureDataLakeStorage1')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('AzureDataLakeStorage1_properties_typeProperties_url')]",
					"accountKey": {
						"type": "SecureString",
						"value": "[parameters('AzureDataLakeStorage1_accountKey')]"
					}
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AzureSqlDatabase1')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureSqlDatabase",
				"typeProperties": {
					"connectionString": "[parameters('AzureSqlDatabase1_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/keyVaultLinkedservice')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"parameters": {
					"keyVaultName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "AzureKeyVault",
				"typeProperties": {
					"baseUrl": "[parameters('keyVaultLinkedservice_properties_typeProperties_baseUrl')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AutoResolveIntegrationRuntime')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "Managed",
				"typeProperties": {
					"computeProperties": {
						"location": "AutoResolve",
						"dataFlowProperties": {
							"computeType": "General",
							"coreCount": 8,
							"timeToLive": 0
						}
					}
				},
				"managedVirtualNetwork": {
					"type": "ManagedVirtualNetworkReference",
					"referenceName": "default"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/managedVirtualNetworks/default')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/DataverseToAzureSQL')]",
			"type": "Microsoft.Synapse/workspaces/dataflows",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"description": "Writes Dataverse data in Azure Data Lake Storage Gen2 to Azure SQL Database.",
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "AzureDataLakeStorage1",
								"type": "LinkedServiceReference"
							},
							"name": "ADLS"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "AzureSqlTable2",
								"type": "DatasetReference"
							},
							"name": "SQL"
						}
					],
					"transformations": [],
					"script": "parameters{\n\tContainerName as string (\"Dataverse Container Name\"),\n\tTableName as string (\"Dataverse Table Name\")\n}\nsource(output(\n\t\tId as string,\n\t\tSinkCreatedOn as timestamp,\n\t\tSinkModifiedOn as timestamp,\n\t\tstatecode as long,\n\t\tstatuscode as long,\n\t\tindustrycode as long,\n\t\tcustomersizecode as long,\n\t\taccountratingcode as long,\n\t\taddress1_shippingmethodcode as long,\n\t\tbusinesstypecode as long,\n\t\tshippingmethodcode as long,\n\t\tpreferredappointmenttimecode as long,\n\t\taddress2_shippingmethodcode as long,\n\t\tterritorycode as long,\n\t\taccountclassificationcode as long,\n\t\tpreferredcontactmethodcode as long,\n\t\tpreferredappointmentdaycode as long,\n\t\tpaymenttermscode as long,\n\t\taddress1_addresstypecode as long,\n\t\townershipcode as long,\n\t\taddress2_freighttermscode as long,\n\t\taddress2_addresstypecode as long,\n\t\taddress1_freighttermscode as long,\n\t\tcustomertypecode as long,\n\t\taccountcategorycode as long,\n\t\tmarketingonly as boolean,\n\t\tdonotpostalmail as boolean,\n\t\tdonotbulkpostalmail as boolean,\n\t\tdonotbulkemail as boolean,\n\t\tdonotphone as boolean,\n\t\tdonotsendmm as boolean,\n\t\tisprivate as boolean,\n\t\tmerged as boolean,\n\t\tdonotfax as boolean,\n\t\tdonotemail as boolean,\n\t\tcreditonhold as boolean,\n\t\tfollowemail as boolean,\n\t\tparticipatesinworkflow as boolean,\n\t\tmodifiedby as string,\n\t\tmodifiedby_entitytype as string,\n\t\tdefaultpricelevelid as string,\n\t\tdefaultpricelevelid_entitytype as string,\n\t\tmodifiedbyexternalparty as string,\n\t\tmodifiedbyexternalparty_entitytype as string,\n\t\tprimarycontactid as string,\n\t\tprimarycontactid_entitytype as string,\n\t\tpreferredserviceid as string,\n\t\tpreferredserviceid_entitytype as string,\n\t\tpreferredequipmentid as string,\n\t\tpreferredequipmentid_entitytype as string,\n\t\towninguser as string,\n\t\towninguser_entitytype as string,\n\t\ttransactioncurrencyid as string,\n\t\ttransactioncurrencyid_entitytype as string,\n\t\tslainvokedid as string,\n\t\tslainvokedid_entitytype as string,\n\t\tcreatedbyexternalparty as string,\n\t\tcreatedbyexternalparty_entitytype as string,\n\t\tmodifiedonbehalfby as string,\n\t\tmodifiedonbehalfby_entitytype as string,\n\t\tcreatedonbehalfby as string,\n\t\tcreatedonbehalfby_entitytype as string,\n\t\tparentaccountid as string,\n\t\tparentaccountid_entitytype as string,\n\t\tslaid as string,\n\t\tslaid_entitytype as string,\n\t\tterritoryid as string,\n\t\tterritoryid_entitytype as string,\n\t\tmasterid as string,\n\t\tmasterid_entitytype as string,\n\t\towningbusinessunit as string,\n\t\towningbusinessunit_entitytype as string,\n\t\toriginatingleadid as string,\n\t\toriginatingleadid_entitytype as string,\n\t\towningteam as string,\n\t\towningteam_entitytype as string,\n\t\tpreferredsystemuserid as string,\n\t\tpreferredsystemuserid_entitytype as string,\n\t\tcreatedby as string,\n\t\tcreatedby_entitytype as string,\n\t\townerid as string,\n\t\townerid_entitytype as string,\n\t\taging90 as decimal(18,2),\n\t\tcreditlimit_base as decimal(18,2),\n\t\taging60_base as decimal(18,2),\n\t\tmarketcap as decimal(18,2),\n\t\topenrevenue as decimal(18,2),\n\t\trevenue as decimal(18,2),\n\t\taging30_base as decimal(18,2),\n\t\tmarketcap_base as decimal(18,2),\n\t\trevenue_base as decimal(18,2),\n\t\taging60 as decimal(18,2),\n\t\taging90_base as decimal(18,2),\n\t\taging30 as decimal(18,2),\n\t\topenrevenue_base as decimal(18,2),\n\t\tcreditlimit as decimal(18,2),\n\t\taddress2_postalcode as string,\n\t\taddress1_longitude as decimal(18,2),\n\t\taddress2_county as string,\n\t\tdefaultpricelevelidname as string,\n\t\tslainvokedidname as string,\n\t\tmasteraccountidname as string,\n\t\toverriddencreatedon as timestamp,\n\t\tentityimageid as string,\n\t\taddress2_longitude as decimal(18,2),\n\t\taddress2_line3 as string,\n\t\toriginatingleadidyominame as string,\n\t\taddress1_telephone2 as string,\n\t\ttransactioncurrencyidname as string,\n\t\taddress1_upszone as string,\n\t\tprocessid as string,\n\t\topenrevenue_date as timestamp,\n\t\taddress2_city as string,\n\t\tmasteraccountidyominame as string,\n\t\temailaddress2 as string,\n\t\temailaddress1 as string,\n\t\towneridyominame as string,\n\t\taddress1_country as string,\n\t\tmodifiedonbehalfbyname as string,\n\t\tmodifiedbyname as string,\n\t\texchangerate as decimal(18,2),\n\t\taddress1_line2 as string,\n\t\taddress1_postofficebox as string,\n\t\tcreatedbyexternalpartyyominame as string,\n\t\topenrevenue_state as long,\n\t\tnumberofemployees as long,\n\t\tmodifiedbyexternalpartyyominame as string,\n\t\taddress1_utcoffset as long,\n\t\taddress2_stateorprovince as string,\n\t\tterritoryidname as string,\n\t\ttelephone1 as string,\n\t\taddress1_stateorprovince as string,\n\t\tmodifiedon as timestamp,\n\t\tcreatedon as timestamp,\n\t\taccountid as string,\n\t\taddress2_utcoffset as long,\n\t\toriginatingleadidname as string,\n\t\tmodifiedbyyominame as string,\n\t\tparentaccountidyominame as string,\n\t\tpreferredserviceidname as string,\n\t\taddress1_county as string,\n\t\taddress1_telephone3 as string,\n\t\tentityimage_url as string,\n\t\tprimarytwitterid as string,\n\t\taddress2_line2 as string,\n\t\tyominame as string,\n\t\tcreatedonbehalfbyname as string,\n\t\topendeals_state as long,\n\t\taddress1_city as string,\n\t\tfax as string,\n\t\ttimezoneruleversionnumber as long,\n\t\tcreatedonbehalfbyyominame as string,\n\t\taddress2_composite as string,\n\t\towneridtype as string,\n\t\taddress1_name as string,\n\t\taddress2_upszone as string,\n\t\tparentaccountidname as string,\n\t\ttelephone3 as string,\n\t\tentityimage_timestamp as long,\n\t\tmodifiedbyexternalpartyname as string,\n\t\temailaddress3 as string,\n\t\taddress1_latitude as decimal(18,2),\n\t\tteamsfollowed as long,\n\t\tprimarysatoriid as string,\n\t\taddress2_country as string,\n\t\ttelephone2 as string,\n\t\tcreatedbyexternalpartyname as string,\n\t\tlastusedincampaign as timestamp,\n\t\taccountnumber as string,\n\t\taddress1_line3 as string,\n\t\tprimarycontactidname as string,\n\t\ttimespentbymeonemailandmeetings as string,\n\t\taddress1_primarycontactname as string,\n\t\tpreferredsystemuseridname as string,\n\t\taddress2_postofficebox as string,\n\t\tpreferredequipmentidname as string,\n\t\tprimarycontactidyominame as string,\n\t\tversionnumber as long,\n\t\topendeals as long,\n\t\tslaname as string,\n\t\taddress1_composite as string,\n\t\tftpsiteurl as string,\n\t\tsic as string,\n\t\taddress2_line1 as string,\n\t\tlastonholdtime as timestamp,\n\t\taddress1_telephone1 as string,\n\t\taddress2_fax as string,\n\t\tdescription as string,\n\t\tstageid as string,\n\t\twebsiteurl as string,\n\t\tutcconversiontimezonecode as long,\n\t\tstockexchange as string,\n\t\taddress1_addressid as string,\n\t\taddress2_latitude as decimal(18,2),\n\t\ttraversedpath as string,\n\t\taddress2_addressid as string,\n\t\tonholdtime as long,\n\t\taddress1_line1 as string,\n\t\tcreatedbyyominame as string,\n\t\towneridname as string,\n\t\taddress2_telephone1 as string,\n\t\taddress2_telephone2 as string,\n\t\taddress2_telephone3 as string,\n\t\taddress2_name as string,\n\t\tcreatedbyname as string,\n\t\ttickersymbol as string,\n\t\taddress2_primarycontactname as string,\n\t\tmodifiedonbehalfbyyominame as string,\n\t\topendeals_date as timestamp,\n\t\taddress1_fax as string,\n\t\timportsequencenumber as long,\n\t\tname as string,\n\t\tcr79c_addcolumn as string,\n\t\tpreferredsystemuseridyominame as string,\n\t\tsharesoutstanding as long,\n\t\taddress1_postalcode as string\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: true,\n\tignoreNoFilesFound: false,\n\tentity: ($TableName),\n\tformat: 'cdm',\n\tmanifestType: 'model',\n\tfolderPath: '',\n\tfileSystem: ($ContainerName),\n\tdateFormats: ['MM/dd/yyyy'],\n\ttimestampFormats: ['MM/dd/yyyy hh:mm:ss a'],\n\tpreferredIntegralType: 'long',\n\tpreferredFractionalType: 'float') ~> ADLS\nADLS sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false,\n\tformat: 'table',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\terrorHandlingOption: 'stopOnFirstError') ~> SQL"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/linkedServices/AzureDataLakeStorage1')]",
				"[concat(variables('workspaceId'), '/datasets/AzureSqlTable2')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/WorkspaceSystemIdentity')]",
			"type": "Microsoft.Synapse/workspaces/credentials",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "ManagedIdentity",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/SQL script 1')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"content": {
					"query": "SELECT TOP (100) [Id]\n,[SinkCreatedOn]\n,[SinkModifiedOn]\n,[statecode]\n,[statuscode]\n,[address1_addresstypecode]\n,[address1_shippingmethodcode]\n,[paymenttermscode]\n,[accountcategorycode]\n,[address1_freighttermscode]\n,[accountratingcode]\n,[preferredappointmenttimecode]\n,[accountclassificationcode]\n,[customertypecode]\n,[ownershipcode]\n,[preferredcontactmethodcode]\n,[territorycode]\n,[industrycode]\n,[businesstypecode]\n,[shippingmethodcode]\n,[address2_addresstypecode]\n,[customersizecode]\n,[address2_shippingmethodcode]\n,[preferredappointmentdaycode]\n,[address2_freighttermscode]\n,[msdyn_gdproptout]\n,[donotpostalmail]\n,[donotsendmm]\n,[creditonhold]\n,[donotbulkpostalmail]\n,[isprivate]\n,[donotbulkemail]\n,[donotfax]\n,[donotemail]\n,[marketingonly]\n,[followemail]\n,[merged]\n,[donotphone]\n,[participatesinworkflow]\n,[slaid]\n,[slaid_entitytype]\n,[transactioncurrencyid]\n,[transactioncurrencyid_entitytype]\n,[createdbyexternalparty]\n,[createdbyexternalparty_entitytype]\n,[slainvokedid]\n,[slainvokedid_entitytype]\n,[originatingleadid]\n,[originatingleadid_entitytype]\n,[territoryid]\n,[territoryid_entitytype]\n,[preferredserviceid]\n,[preferredserviceid_entitytype]\n,[primarycontactid]\n,[primarycontactid_entitytype]\n,[parentaccountid]\n,[parentaccountid_entitytype]\n,[owningbusinessunit]\n,[owningbusinessunit_entitytype]\n,[modifiedby]\n,[modifiedby_entitytype]\n,[modifiedonbehalfby]\n,[modifiedonbehalfby_entitytype]\n,[owninguser]\n,[owninguser_entitytype]\n,[owningteam]\n,[owningteam_entitytype]\n,[preferredequipmentid]\n,[preferredequipmentid_entitytype]\n,[createdonbehalfby]\n,[createdonbehalfby_entitytype]\n,[masterid]\n,[masterid_entitytype]\n,[modifiedbyexternalparty]\n,[modifiedbyexternalparty_entitytype]\n,[defaultpricelevelid]\n,[defaultpricelevelid_entitytype]\n,[msdyn_accountkpiid]\n,[msdyn_accountkpiid_entitytype]\n,[createdby]\n,[createdby_entitytype]\n,[preferredsystemuserid]\n,[preferredsystemuserid_entitytype]\n,[ownerid]\n,[ownerid_entitytype]\n,[aging90]\n,[aging30]\n,[openrevenue]\n,[aging60_base]\n,[creditlimit]\n,[revenue]\n,[marketcap]\n,[openrevenue_base]\n,[aging60]\n,[creditlimit_base]\n,[revenue_base]\n,[aging90_base]\n,[marketcap_base]\n,[aging30_base]\n,[emailaddress3]\n,[emailaddress2]\n,[emailaddress1]\n,[masteraccountidyominame]\n,[address1_city]\n,[modifiedon]\n,[overriddencreatedon]\n,[websiteurl]\n,[address1_longitude]\n,[createdbyexternalpartyname]\n,[sharesoutstanding]\n,[transactioncurrencyidname]\n,[yominame]\n,[preferredsystemuseridyominame]\n,[opendeals_date]\n,[modifiedbyexternalpartyyominame]\n,[masteraccountidname]\n,[preferredsystemuseridname]\n,[address2_stateorprovince]\n,[address2_country]\n,[address2_line2]\n,[address1_line3]\n,[onholdtime]\n,[owningbusinessunitname]\n,[originatingleadidname]\n,[parentaccountidname]\n,[address1_utcoffset]\n,[numberofemployees]\n,[modifiedbyexternalpartyname]\n,[exchangerate]\n,[address2_county]\n,[telephone3]\n,[address2_city]\n,[address2_latitude]\n,[createdon]\n,[address1_composite]\n,[opendeals_state]\n,[address2_postalcode]\n,[lastusedincampaign]\n,[processid]\n,[owneridyominame]\n,[entityimage_url]\n,[teamsfollowed]\n,[address2_line3]\n,[description]\n,[timezoneruleversionnumber]\n,[address1_county]\n,[createdbyname]\n,[address1_line1]\n,[address2_postofficebox]\n,[address2_telephone1]\n,[address2_telephone2]\n,[address2_telephone3]\n,[originatingleadidyominame]\n,[preferredequipmentidname]\n,[address1_addressid]\n,[traversedpath]\n,[territoryidname]\n,[address1_telephone2]\n,[createdonbehalfbyname]\n,[address2_name]\n,[openrevenue_state]\n,[primarysatoriid]\n,[name]\n,[entityimageid]\n,[timespentbymeonemailandmeetings]\n,[primarytwitterid]\n,[owneridname]\n,[entityimage_timestamp]\n,[createdonbehalfbyyominame]\n,[address2_composite]\n,[address1_country]\n,[address1_stateorprovince]\n,[preferredserviceidname]\n,[modifiedonbehalfbyname]\n,[createdbyexternalpartyyominame]\n,[address2_line1]\n,[address1_telephone1]\n,[primarycontactidname]\n,[address1_telephone3]\n,[address1_postofficebox]\n,[slainvokedidname]\n,[fax]\n,[sic]\n,[address2_utcoffset]\n,[stageid]\n,[accountnumber]\n,[address2_fax]\n,[owneridtype]\n,[address2_longitude]\n,[ftpsiteurl]\n,[address1_primarycontactname]\n,[modifiedbyyominame]\n,[lastonholdtime]\n,[address1_line2]\n,[modifiedonbehalfbyyominame]\n,[openrevenue_date]\n,[address2_upszone]\n,[address1_postalcode]\n,[tickersymbol]\n,[utcconversiontimezonecode]\n,[defaultpricelevelidname]\n,[stockexchange]\n,[importsequencenumber]\n,[msdyn_accountkpiidname]\n,[telephone2]\n,[versionnumber]\n,[accountid]\n,[telephone1]\n,[address1_name]\n,[address1_fax]\n,[address1_latitude]\n,[primarycontactidyominame]\n,[modifiedbyname]\n,[createdbyyominame]\n,[address1_upszone]\n,[address2_addressid]\n,[slaname]\n,[parentaccountidyominame]\n,[address2_primarycontactname]\n,[opendeals]\n FROM [dataverse_salestrial_unq1cc8161bd798478faef1b51afa8f1].[dbo].[account]",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "dataverse_salestrial_unq1cc8161bd798478faef1b51afa8f1",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/Revenue Summary')]",
			"type": "Microsoft.Synapse/workspaces/notebooks",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"nbformat": 4,
				"nbformat_minor": 2,
				"bigDataPool": {
					"referenceName": "ws1sparkpool1",
					"type": "BigDataPoolReference"
				},
				"sessionProperties": {
					"driverMemory": "28g",
					"driverCores": 4,
					"executorMemory": "28g",
					"executorCores": 4,
					"numExecutors": 2,
					"conf": {
						"spark.dynamicAllocation.enabled": "false",
						"spark.dynamicAllocation.minExecutors": "2",
						"spark.dynamicAllocation.maxExecutors": "2",
						"spark.autotune.trackingId": "387ee129-2b3c-45e2-8dea-92c3e596ddd8"
					}
				},
				"metadata": {
					"saveOutput": true,
					"enableDebugMode": false,
					"kernelspec": {
						"name": "synapse_pyspark",
						"display_name": "Synapse PySpark"
					},
					"language_info": {
						"name": "python"
					},
					"a365ComputeOptions": {
						"id": "/subscriptions/644bb777-9ebb-4e13-af05-60e200e624fb/resourceGroups/dyn/providers/Microsoft.Synapse/workspaces/dynn253kxg7rdy2mpocws1/bigDataPools/ws1sparkpool1",
						"name": "ws1sparkpool1",
						"type": "Spark",
						"endpoint": "https://dynn253kxg7rdy2mpocws1.dev.azuresynapse.net/livyApi/versions/2019-11-01-preview/sparkPools/ws1sparkpool1",
						"auth": {
							"type": "AAD",
							"authResource": "https://dev.azuresynapse.net"
						},
						"sparkVersion": "2.4",
						"nodeCount": 5,
						"cores": 4,
						"memory": 28
					},
					"sessionKeepAliveTimeout": 30
				},
				"cells": [
					{
						"cell_type": "markdown",
						"metadata": {
							"nteract": {
								"transient": {
									"deleting": false
								}
							}
						},
						"source": [
							"<h1>Update the Databasename with your Dataverse Databasename.</h1>\r\n",
							"<img src=\"https://synapse1poc.blob.core.windows.net/dataverselnksynp/Dataverse_DB.gif\" alt=\"Surface Device\" width=\"75%\"/>\r\n",
							"\r\n",
							"\t"
						]
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"microsoft": {
								"language": "sparksql"
							},
							"collapsed": false
						},
						"source": [
							"%%sql\r\n",
							"USE  dataverse_salestrial_unq1cc8161bd798478faef1b51afa8f1"
						],
						"outputs": [],
						"execution_count": 1
					},
					{
						"cell_type": "markdown",
						"metadata": {
							"nteract": {
								"transient": {
									"deleting": false
								}
							}
						},
						"source": [
							"<h1>Identify revenue distribution from leads, opportunities, and accounts with matplotlib.</h1>\r\n",
							"\r\n",
							"<img src=\"https://synapse1poc.blob.core.windows.net/dataverselnksynp/RS_loa.png\" alt=\"Surface Device\" width=\"75%\"/>"
						]
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"microsoft": {
								"language": "python"
							}
						},
						"source": [
							"%%pyspark\r\n",
							"import pandas as pd\r\n",
							"import matplotlib.pyplot as plt\r\n",
							"#Get the Data\r\n",
							"df = spark.sql(\"\"\"\r\n",
							"    SELECT revenue, 'account' as source FROM account UNION\r\n",
							"    SELECT revenue, 'lead' as source FROM lead UNION \r\n",
							"    SELECT totalamount_base, 'opportunity' as source FROM opportunity\r\n",
							"\"\"\")\r\n",
							"#Summarize the Data\r\n",
							"pdf = df.toPandas()\r\n",
							"revenue_data = pdf.groupby(\"source\")[[\"revenue\"]].sum()\r\n",
							"#Format the Plot\r\n",
							"my_colors = ['green','red', 'yellow']\r\n",
							"\r\n",
							"plt.pie(revenue_data[\"revenue\"], labels = revenue_data.index, autopct = '%1.1f%%', colors = my_colors)\r\n",
							"plt.show()"
						],
						"outputs": [],
						"execution_count": 2
					},
					{
						"cell_type": "markdown",
						"metadata": {
							"nteract": {
								"transient": {
									"deleting": false
								}
							}
						},
						"source": [
							"<h1>Display potential revenue from leads and opportunities on a quarterly basis.</h1>\r\n",
							"\r\n",
							"<img src=\"https://synapse1poc.blob.core.windows.net/dataverselnksynp/RS_qb.png\" alt=\"Surface Device\" width=\"75%\"/>"
						]
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"microsoft": {
								"language": "python"
							}
						},
						"source": [
							"%%pyspark\r\n",
							"import pandas as pd\r\n",
							"import matplotlib.pyplot as plt\r\n",
							"#Get the Leads Data\r\n",
							"df = spark.sql(\"\"\"\r\n",
							"    SELECT revenue, purchasetimeframe, 'lead' as source FROM lead\r\n",
							"\"\"\")\r\n",
							"#Summarize the Data\r\n",
							"pdf = df.toPandas()\r\n",
							"data = pdf.groupby(['purchasetimeframe'])[['revenue']].sum()\r\n",
							"\r\n",
							"plt.bar(data.index, data[\"revenue\"], color = \"blue\", label = \"Lead\")\r\n",
							"#Get the Opportunity Data\r\n",
							"df = spark.sql(\"\"\"\r\n",
							"    SELECT totalamount_base, purchasetimeframe, 'opportunity' as source FROM opportunity\r\n",
							"\"\"\")\r\n",
							"#Summairze the Data\r\n",
							"pdf = df.toPandas()\r\n",
							"data = pdf.groupby([\"purchasetimeframe\"])[[\"totalamount_base\"]].sum()\r\n",
							"\r\n",
							"plt.bar(data.index, data[\"totalamount_base\"], color = \"orange\", label = \"Opportunity\")\r\n",
							"#Format the Plot\r\n",
							"plt.xticks(ticks=[-1, 0, 1, 2, 3, 4], labels=[\"\", \"Q1\", \"Q2\", \"Q3\", \"Q4\", \"This Year\"])\r\n",
							"plt.yticks(ticks= [0.e+00, 2.e+07, 4.e+07, 6.e+07, 8.e+07, 1.e+08], labels=[\"$0\", \"$20M\", \"$40M\", \"$60M\", \"$80M\", \"$100M\"])\r\n",
							"plt.legend()\r\n",
							"plt.show()"
						],
						"outputs": [],
						"execution_count": 3
					},
					{
						"cell_type": "markdown",
						"metadata": {
							"nteract": {
								"transient": {
									"deleting": false
								}
							}
						},
						"source": [
							"<h1>Identify the contact information for each account by joining the Dataverse tables into a new Spark Table</h1>"
						]
					},
					{
						"cell_type": "code",
						"metadata": {
							"jupyter": {
								"source_hidden": false,
								"outputs_hidden": false
							},
							"nteract": {
								"transient": {
									"deleting": false
								}
							},
							"microsoft": {
								"language": "python"
							},
							"collapsed": false
						},
						"source": [
							"%%pyspark\r\n",
							"#Join Datasets\r\n",
							"df = spark.sql(\"\"\"\r\n",
							" SELECT a.Id AS account_ID, a.name AS account_name, b.fullname AS contact_name, b.emailaddress1 AS contact_email, b.donotemail\r\n",
							" FROM\r\n",
							" dataverse_salestrial_unq1cc8161bd798478faef1b51afa8f1.account a\r\n",
							" INNER JOIN\r\n",
							" (\r\n",
							"     SELECT parentcustomerid, fullname, emailaddress1, donotemail\r\n",
							"     FROM \r\n",
							"     dataverse_salestrial_unq1cc8161bd798478faef1b51afa8f1.contact\r\n",
							") b\r\n",
							"ON a.Id = b.parentcustomerid\r\n",
							"\"\"\")\r\n",
							"\r\n",
							"#Write Joined Dataset to Spark Table\r\n",
							"df.write.mode(\"overwrite\").saveAsTable(\"default.AccountEmails\")\r\n",
							"\r\n",
							"#Read the Spark Table\r\n",
							"display(df)"
						],
						"outputs": [],
						"execution_count": 5
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/dynn253kxg7rdy2mpocws1p1')]",
			"type": "Microsoft.Synapse/workspaces/sqlPools",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"collation": "SQL_Latin1_General_CP1_CI_AS",
				"maxSizeBytes": 263882790666240,
				"annotations": []
			},
			"dependsOn": [],
			"location": "westus"
		},
		{
			"name": "[concat(parameters('workspaceName'), '/ws1sparkpool1')]",
			"type": "Microsoft.Synapse/workspaces/bigDataPools",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"autoPause": {
					"enabled": true,
					"delayInMinutes": 15
				},
				"autoScale": {
					"enabled": true,
					"maxNodeCount": 25,
					"minNodeCount": 3
				},
				"nodeCount": 5,
				"nodeSize": "Small",
				"nodeSizeFamily": "MemoryOptimized",
				"sparkVersion": "2.4",
				"isComputeIsolationEnabled": false,
				"sessionLevelPackagesEnabled": false,
				"annotations": []
			},
			"dependsOn": [],
			"location": "westus"
		},
		{
			"name": "[concat(parameters('workspaceName'), '/default')]",
			"type": "Microsoft.Synapse/workspaces/managedVirtualNetworks",
			"apiVersion": "2019-06-01-preview",
			"properties": {},
			"dependsOn": []
		}
	]
}